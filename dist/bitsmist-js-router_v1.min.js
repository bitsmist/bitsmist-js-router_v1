!function(){"use strict";function r(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var o=1,i="";if("?"===e[u=n+1])throw new TypeError('Pattern cannot start with "?" at '+u);for(;u<e.length;)if("\\"!==e[u]){if(")"===e[u]){if(0===--o){u++;break}}else if("("===e[u]&&(o++,"?"!==e[u+1]))throw new TypeError("Capturing groups are not allowed at "+u);i+=e[u++]}else i+=e[u++]+e[u++];if(o)throw new TypeError("Unbalanced pattern at "+n);if(!i)throw new TypeError("Missing pattern at "+n);t.push({type:"PATTERN",index:n,value:i}),n=u}else{for(var a="",u=n+1;u<e.length;){var s=e.charCodeAt(u);if(!(48<=s&&s<=57||65<=s&&s<=90||97<=s&&s<=122||95===s))break;a+=e[u++]}if(!a)throw new TypeError("Missing parameter name at "+n);t.push({type:"NAME",index:n,value:a}),n=u}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),e=t.prefixes,n=void 0===e?"./":e,o="[^"+m(t.delimiter||"/#?")+"]+?",i=[],a=0,u=0,s="",p=function(e){if(u<r.length&&r[u].type===e)return r[u++].value},c=function(e){var t=p(e);if(void 0!==t)return t;var n=r[u],t=n.type,n=n.index;throw new TypeError("Unexpected "+t+" at "+n+", expected "+e)},f=function(){for(var e,t="";e=p("CHAR")||p("ESCAPED_CHAR");)t+=e;return t};u<r.length;){var l,h=p("CHAR"),d=p("NAME"),_=p("PATTERN");d||_?(l=h||"",-1===n.indexOf(l)&&(s+=l,l=""),s&&(i.push(s),s=""),i.push({name:d||a++,prefix:l,suffix:"",pattern:_||o,modifier:p("MODIFIER")||""})):(d=h||p("ESCAPED_CHAR"))?s+=d:(s&&(i.push(s),s=""),p("OPEN")?(l=f(),_=p("NAME")||"",h=p("PATTERN")||"",d=f(),c("CLOSE"),i.push({name:_||(h?a++:""),pattern:_&&!h?o:h,prefix:l,suffix:d,modifier:p("MODIFIER")||""})):c("END"))}return i}function m(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function g(e){return e&&e.sensitive?"":"i"}function a(e,t,n){return function(e,t,n){void 0===n&&(n={});for(var r=n.strict,o=void 0!==r&&r,i=n.start,a=void 0===i||i,u=n.end,r=void 0===u||u,i=n.encode,s=void 0===i?function(e){return e}:i,u="["+m(n.endsWith||"")+"]|$",i="["+m(n.delimiter||"/#?")+"]",p=a?"^":"",c=0,f=e;c<f.length;c++){var l,h,d,_=f[c];"string"==typeof _?p+=m(s(_)):(l=m(s(_.prefix)),h=m(s(_.suffix)),_.pattern?(t&&t.push(_),l||h?"+"===_.modifier||"*"===_.modifier?(d="*"===_.modifier?"?":"",p+="(?:"+l+"((?:"+_.pattern+")(?:"+h+l+"(?:"+_.pattern+"))*)"+h+")"+d):p+="(?:"+l+"("+_.pattern+")"+h+")"+_.modifier:p+="("+_.pattern+")"+_.modifier):p+="(?:"+l+h+")"+_.modifier)}r?(o||(p+=i+"?"),p+=n.endsWith?"(?="+u+")":"$"):(e=e[e.length-1],e="string"==typeof e?-1<i.indexOf(e[e.length-1]):void 0===e,o||(p+="(?:"+i+"(?="+u+"))?"),e||(p+="(?="+i+"|"+u+")"));return new RegExp(p,g(n))}(r(e,n),t,n)}function u(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,o=n.exec(e.source);o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}(e,t):Array.isArray(e)?(o=t,i=n,r=(r=e).map(function(e){return u(e,o,i).source}),new RegExp("(?:"+r.join("|")+")",g(i))):a(e,t,n);var r,o,i}var n=function(e){function h(){e.apply(this,arguments)}return e&&(h.__proto__=e),((h.prototype=Object.create(e&&e.prototype)).constructor=h).init=function(e,t,n){Object.defineProperty(t,"routeInfo",{get:function(){return this._routeInfo}}),Object.defineProperty(t,"specs",{get:function(){return this._specs}}),t.loadParameters=function(){return h._loadParameters()},t.openRoute=function(e,t){return h._open(this,e,t)},t.replaceRoute=function(e,t){return h._replace(this,e,t)},t.jumpRoute=function(e,t){return h._jump(this,e,t)},t.refreshRoute=function(e,t){return h._refresh(this,e,t)},t.updateRoute=function(e,t){return h._update(this,e,t)},t._routes=[],t._specs={}},h.organize=function(e,t,n){var r=t.settings.get("routes");if(r){for(var o=0;o<r.length;o++)h._addRoute(t,r[o]);t._routeInfo=h.__loadRouteInfo(t,window.location.href)}var i=t.settings.get("specs");return i&&Object.keys(i).forEach(function(e){t._specs[e]=i[e]}),n},h._addRoute=function(e,t,n){var r=[],r={origin:t.origin,name:t.name,path:t.path,keys:r,specName:t.specName,componentName:t.componentName,re:u(t.path,r)};n?e._routes.unshift(r):e._routes.push(r)},h._buildUrl=function(e,t){var n;return e.url?n=e.url:(n=e.path||t._routeInfo.path,n+=e.query?"?"+e.query:"",n+=e.queryParameters?h._buildUrlQuery(e.queryParameters):""),n},h._buildUrlQuery=function(n){var e="";return(e=n?Object.keys(n).reduce(function(e,t){return Array.isArray(n[t])?e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t].join())+"&":n[t]&&(e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t])+"&"),e},""):e)?"?"+e.slice(0,-1):""},h._loadParameters=function(){var e,t,n={};if(-1<window.location.href.indexOf("?"))for(var r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<r.length;o++)t=(e=r[o].split("="))[1]&&e[1].split("#")[0],n[e[0]]=decodeURIComponent(t);return n},h._open=function(e,t,n){(n=Object.assign({},n)).pushState=void 0===n.pushState||n.pushState;var r=h._buildUrl(t,e),o=Object.assign({},e._routeInfo),i=h.__loadRouteInfo(e,r);e._routeInfo=h.__loadRouteInfo(e,r),!n.jump&&i.name&&o.name==i.name?Promise.resolve().then(function(){n.pushState&&history.pushState(h.__getDefaultState("_open.pushState"),null,r)}).then(function(){return o.specName!=i.specName?h._update(e,i,n):h._refresh(e,t,n)}).then(function(){t.dispUrl&&history.replaceState(h.__getDefaultState("_open.dispUrl"),null,t.dispUrl)}):h._jump(e,r)},h._jump=function(e,t){e=h._buildUrl(t,e);window.location.href=e},h._refresh=function(e,t,n){var r=e._routeInfo.componentName;if(e._components[r])return e._components[r].refresh({sender:e,pushState:!1})},h._update=function(e,t,n){return Promise.resolve().then(function(){return e.clearOrganizers()}).then(function(){return h.__initSpec(e,t.specName)})},h._replace=function(e,t,n){history.replaceState(h.__getDefaultState("replaceRoute"),null,h._buildUrl(t,e)),e._routeInfo=h.__loadRouteInfo(e,window.location.href)},h.__initSpec=function(t,n){if(n&&!t._specs[n])return Promise.resolve().then(function(){if(!t._specs[n])return h.__loadSpec(n,t.settings.get("system.specPath")).then(function(e){t._specs[n]=e})}).then(function(){return t.callOrganizers("afterSpecLoad",t._specs[n])}).then(function(){return t.trigger("afterSpecLoad",t,{spec:t._specs[t._routeInfo.specName]})})},h.__loadSpec=function(e,t){var n,r=BITSMIST.v1.Util.concatPath([t,e+".js"]),e=[];return e.push(BITSMIST.v1.AjaxUtil.ajaxRequest({url:r,method:"GET"})),Promise.all(e).then(function(e){try{n=JSON.parse(e[0].responseText)}catch(e){throw e instanceof SyntaxError?new SyntaxError("Illegal json string. url="+r+", message="+e.message):e}return n})},h.__loadRouteInfo=function(e,t){for(var n,r={},o=new URL(t,window.location.href),i={},a=e._routes.length-1;0<=a;a--)if(!e._routes[a].origin||e._routes[a].origin&&o.origin==e._routes[a].origin){var u=e._routes[a].path?e._routes[a].re.exec(o.pathname):[];if(u){n=e._routes[a].name,l=e._routes[a].specName||"";for(var s=e._routes[a].componentName,p=0;p<u.length-1;p++){i[e._routes[a].keys[p].name]=u[p+1];var c=e._routes[a].keys[p].name,f=u[p+1],l=l.replace("{{:"+c+"}}",f)}break}}return r.name=n,r.specName=l,r.componentName=s,r.url=o.href,r.path=o.pathname,r.query=o.search,r.parsedUrl=o,r.routeParameters=i,r.queryParameters=h._loadParameters(),r},h.__initPopState=function(n){window.history&&window.history.pushState&&window.addEventListener("popstate",function(e){if(e.state){var t,e=n._routeInfo.componentName;return n._components&&n._components[e]&&(t=n._components[e].trigger("beforePopState",n)),Promise.all([t]).then(function(){return h._open(n,h.__loadRouteInfo(n,window.location.href),{pushState:!1})}).then(function(){var e=n._routeInfo.componentName;if(n._components&&n._components[e])return n._components[e].trigger("afterPopState",n)})}})},h.__getDefaultState=function(e){return e+":"+window.location.href},h}(BITSMIST.v1.Organizer);function e(){return Reflect.construct(BITSMIST.v1.Component,[],this.constructor)}BITSMIST.v1.ClassUtil.inherit(e,BITSMIST.v1.Component),customElements.define("bm-router",e),e.prototype.start=function(e){var t=this;return e=BITSMIST.v1.Util.deepMerge({name:"Router",autoSetup:!1,organizers:{RouteOrganizer:""}},e),BITSMIST.v1.Component.prototype.start.call(this,e).then(function(){t.changeState("routing"),history.replaceState(n.__getDefaultState("connect"),null,null),n.__initPopState(t);var e=t.getAttribute("data-specpath")||"";return e&&t._settings.set("system.specPath",e),n.__initSpec(t,t._routeInfo.specName).then(function(){t.changeState("routed")})})},window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},BITSMIST.v1.OrganizerOrganizer.organizers.set("RouteOrganizer",{object:n,targetWords:"routes",targetEvents:["beforeStart","afterSpecLoad"],order:300}),window.BITSMIST.v1.Router=e}();
